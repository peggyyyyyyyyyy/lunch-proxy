<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lunch Go! ä¼æ¥­ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .active-nav { color: #3b82f6; border-top: 3px solid #3b82f6; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="bg-gray-50 h-screen flex flex-col">

    <div class="bg-white p-4 shadow-sm flex justify-between items-center">
        <h1 class="text-xl font-black text-blue-600 italic">LUNCH GO!</h1>
        <div class="flex items-center gap-2">
            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full text-gray-500">åŒ¿å ID: #User${Math.floor(Math.random()*900)+100}</span>
            <i class="fa-regular fa-circle-user text-xl text-gray-400"></i>
        </div>
    </div>

    <main class="flex-1 overflow-y-auto">
        
        <section id="tab-recommend" class="tab-content active p-4">
            <div class="flex gap-2 mb-4 overflow-x-auto pb-2 no-scrollbar">
                <button onclick="toggleOnline()" id="btn-online" class="flex-shrink-0 border px-3 py-1.5 rounded-xl text-sm bg-white shadow-sm">
                    ğŸ›µ ç·šä¸Šè¨‚é¤
                </button>
                <button onclick="openFilter()" class="flex-shrink-0 bg-blue-600 text-white px-3 py-1.5 rounded-xl text-sm shadow-md">
                    <i class="fa-solid fa-sliders"></i> é€²éšç¯©é¸
                </button>
            </div>

            <div class="bg-white rounded-2xl p-4 shadow-sm mb-4">
                <p class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-widest">ç¾åœ¨çš„å¿ƒæƒ…ï¼Ÿ</p>
                <div class="flex justify-between">
                    <button onclick="filterByMood('happy')" class="flex flex-col items-center gap-1">
                        <span class="text-3xl hover:scale-125 transition">ğŸ˜Š</span>
                        <span class="text-[10px] text-gray-500">é–‹å¿ƒ</span>
                    </button>
                    <button onclick="filterByMood('sad')" class="flex flex-col items-center gap-1">
                        <span class="text-3xl hover:scale-125 transition">ğŸ˜¢</span>
                        <span class="text-[10px] text-gray-500">é›£é</span>
                    </button>
                    <button onclick="filterByMood('angry')" class="flex flex-col items-center gap-1">
                        <span class="text-3xl hover:scale-125 transition">ğŸ’¢</span>
                        <span class="text-[10px] text-gray-500">ç”Ÿæ°£</span>
                    </button>
                    <button onclick="filterByMood('fit')" class="flex flex-col items-center gap-1">
                        <span class="text-3xl hover:scale-125 transition">ğŸ’ª</span>
                        <span class="text-[10px] text-gray-500">å¥èº«</span>
                    </button>
                    <button onclick="filterByMood('nervous')" class="flex flex-col items-center gap-1">
                        <span class="text-3xl hover:scale-125 transition">ğŸ·</span>
                        <span class="text-[10px] text-gray-500">ç·Šå¼µ</span>
                    </button>
                </div>
            </div>

            <div id="restaurant-list" class="space-y-4">
                <p class="text-center text-gray-400 mt-10">å®šä½ä¸­...</p>
            </div>
        </section>

        <section id="tab-gacha" class="tab-content h-full flex flex-col items-center justify-center p-6">
            <div id="gacha-machine" class="w-64 h-64 bg-white rounded-full shadow-[0_0_50px_rgba(59,130,246,0.2)] border-8 border-blue-500 flex flex-col items-center justify-center relative overflow-hidden">
                <div id="gacha-status" class="text-6xl mb-2">ğŸ</div>
                <button id="btn-draw" onclick="startDraw()" class="bg-blue-600 text-white px-6 py-2 rounded-full font-bold hover:bg-blue-700 transition">é»æˆ‘æŠ½ç</button>
            </div>
            <div class="mt-8 text-center">
                <p class="text-gray-500">ä»Šæ—¥å‰©é¤˜æ¬¡æ•¸: <span id="draw-count" class="font-bold text-blue-600">3</span>/3</p>
                <p id="snarky-text" class="text-red-500 text-sm mt-2 font-bold opacity-0 transition-opacity">å°±ä½ å•æœ€å¤š ğŸ™„</p>
            </div>
            <div id="draw-result" class="hidden mt-6 w-full p-4 bg-white rounded-2xl border-2 border-dashed border-blue-300">
                </div>
        </section>

        <section id="tab-group" class="tab-content p-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-bold">éƒ¨é–€æªåœ˜ä¸­</h2>
                <button class="bg-orange-500 text-white px-3 py-1 rounded-lg text-sm">+ æˆ‘è¦ç™¼èµ·</button>
            </div>
            <div class="bg-white p-4 rounded-xl shadow-sm mb-3 border-l-4 border-orange-500">
                <div class="flex justify-between items-start">
                    <span class="text-sm font-bold">ä¸€èµ·åƒ [å¥åº·é¤ç›’] ğŸ±</span>
                    <span class="text-xs text-orange-600 font-bold italic">é‚„å·® 2 äºº</span>
                </div>
                <p class="text-xs text-gray-400 mt-1">ç™¼èµ·äºº: #User402 | é è¨ˆ 12:15 å‡ºç™¼</p>
                <div class="mt-3 flex justify-end">
                    <button class="bg-orange-100 text-orange-600 px-4 py-1 rounded-md text-xs font-bold">+1 åŠ å…¥</button>
                </div>
            </div>
        </section>
    </main>

    <nav class="bg-white border-t flex justify-around items-center h-16 pb-2">
        <button onclick="switchTab('recommend')" id="nav-recommend" class="flex flex-col items-center gap-1 active-nav flex-1">
            <i class="fa-solid fa-map-location-dot"></i><span class="text-[10px]">æ¨è–¦</span>
        </button>
        <button onclick="switchTab('gacha')" id="nav-gacha" class="flex flex-col items-center gap-1 flex-1">
            <i class="fa-solid fa-dice"></i><span class="text-[10px]">æŠ½ç±¤</span>
        </button>
        <button onclick="switchTab('group')" id="nav-group" class="flex flex-col items-center gap-1 flex-1">
            <i class="fa-solid fa-users"></i><span class="text-[10px]">æªåœ˜</span>
        </button>
    </nav>

    <script>
        const ZEABUR_URL = "https://lunch-go.zeabur.app/"; // è¨˜å¾—æ›¿æ›ï¼
        let restaurants = [];
        let drawCount = localStorage.getItem('drawCount') || 3;

        // 1. åˆ†é åˆ‡æ›
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(el => el.classList.remove('active-nav'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
            document.getElementById(`nav-${tabId}`).classList.add('active-nav');
        }

        // 2. æƒ…ç·’éæ¿¾å°æ‡‰è¡¨
        function filterByMood(mood) {
            let keyword = "";
            switch(mood) {
                case 'happy': keyword = "fast food"; break;
                case 'sad': keyword = "dessert"; break;
                case 'angry': keyword = "vegetarian"; break; // æˆ–é£²æ–™
                case 'fit': keyword = "healthy food"; break;
                case 'nervous': keyword = "bar"; break;
            }
            alert(`åµæ¸¬åˆ°ä½ çš„æƒ…ç·’ï¼Œæ­£åœ¨ç‚ºä½ æœå°‹å°ˆå±¬é¤å»³...`);
            // é€™é‚Šæœƒè§¸ç™¼å¸¶æœ‰ keyword çš„æœå°‹
            fetchData(keyword);
        }

        // 3. æŠ½ç±¤é‚è¼¯ (æ¯æ—¥ä¸‰æ¬¡)
        function startDraw() {
            if (drawCount <= 0) {
                alert("ä»Šå¤©æ²’æ‰£é¡äº†ï¼");
                return;
            }
            
            const machine = document.getElementById('gacha-machine');
            const status = document.getElementById('gacha-status');
            const snarky = document.getElementById('snarky-text');
            
            status.innerText = "ğŸŒ€";
            machine.classList.add('animate-spin');
            
            setTimeout(() => {
                machine.classList.remove('animate-spin');
                drawCount--;
                localStorage.setItem('drawCount', drawCount);
                document.getElementById('draw-count').innerText = drawCount;
                
                status.innerText = "ğŸ±";
                snarky.style.opacity = "1";
                if(drawCount < 3) snarky.innerText = "å°±ä½ å•æœ€å¤š ğŸ™„";
                
                // éš¨æ©Ÿé¸ä¸€å€‹
                const result = restaurants[Math.floor(Math.random()*restaurants.length)];
                document.getElementById('draw-result').classList.remove('hidden');
                document.getElementById('draw-result').innerHTML = `
                    <p class="text-xs text-blue-500 font-bold">æŠ½ç±¤çµæœï¼š</p>
                    <h4 class="font-bold">${result.name}</h4>
                    <p class="text-xs text-gray-500">â­ ${result.rating}</p>
                `;
            }, 1000);
        }

        // 4. åˆå§‹åŒ–å®šä½èˆ‡è³‡æ–™
        // ... æ­¤è™•å»¶ç”¨ä¹‹å‰ç²å– GPS èˆ‡ fetch(ZEABUR_URL) çš„é‚è¼¯ ...
    </script>
</body>
</html>